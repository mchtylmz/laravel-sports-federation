/*!
 * oneui - v5.9.0
 * @author pixelcave - https://pixelcave.com
 * Copyright (c) 2024
 */
!function () {
    "use strict";

    class e {

        static initCalendar() {
            let e = new Date, t = e.getDate(), a = e.getMonth(), n = e.getFullYear();
            let routeEvents = $('#js-calendar').data('route');

            new FullCalendar.Calendar(document.getElementById("js-calendar"), {
                locale: 'tr',
                contentHeight: 640,
                aspectRatio: 1.25,
                themeSystem: "bootstrap5",
                firstDay: 1,
                editable: false,
                droppable: false,
                headerToolbar: {left: "title", right: "prev,next today dayGridMonth,timeGridWeek,listWeek"},
                titleFormat: { year: 'numeric', month: 'long', day: 'numeric' },
                //dayHeaderFormat: { weekday: 'short',  month: 'numeric', day: 'numeric' },
                buttonText: {
                    today: 'Bugün',
                    month: 'Bu Ay',
                    week: 'Bu Hafta',
                    day: 'Bugün',
                    list: 'Liste'
                },
                eventTimeFormat: { // like '14:30:00'
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                },
                drop: false,
                allDaySlot: false,
                //slotDuration: '00:15:00',
                slotMinTime: '08:00:00',
                slotMaxTime: '22:00:00',
                allDaySlot: false,
                weekNumbers: true,
                weekText: 'H',
                weekTextLong: 'Hafta',
                navLinks: true,
                nowIndicator: true,
                dayMaxEventRows: 3,
                moreLinkContent: function (more) {
                    return more.shortText + ' etkinlik';
                },
                // events: routeEvents,
                events: {
                    url: routeEvents,
                    method: 'GET',
                    extraParams: {
                        value: Math.random()
                    },
                    failure: function() {
                        alert('Etkinlikler yüklenemedi!');
                    },
                    //color: 'white',   // a non-ajax option
                    //textColor: 'black' // a non-ajax option
                },
                eventClick: function (info) {
                    let event = info.event;

                    $.ajaxSetup({
                        headers: {
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                        }
                    });
                    $.ajax({
                        type: 'GET',
                        url: event.extendedProps.view_route,
                        data: {},
                        dataType: 'json',
                        processData: false,
                        contentType: false,
                        cache: false,
                        enctype: 'multipart/form-data',
                        beforeSend: function () {
                            $('.offcanvas-title').html('');
                            $('.offcanvas-body').html('<div class="text-center"><i class="fa fa-spinner fa-pulse fa-3x"></i></div>');
                            $('#offcanvasRight').offcanvas('show');
                        },
                        success: function (response) {
                            $('.offcanvas-title').html(response.title);
                            $('.offcanvas-body').html(response.body);
                        },
                        error: function (response) {
                            $('.offcanvas-body').html(response.responseJSON.message);
                        }
                    });
                }
            }).render()
        }

        static init() {
            this.initCalendar()
        }
    }

    One.onLoad((() => e.init()))
}();
